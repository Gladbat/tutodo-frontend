<div class="container mt-4 mb-5">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2><i class="bi bi-heart-fill text-danger"></i> Mis Favoritos</h2>
    <span class="badge bg-primary">{{ favoritos.length }} productos</span>
  </div>

  <!-- Loader -->
  <div class="text-center py-5" *ngIf="isLoading">
    <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;"></div>
    <p class="mt-3">Cargando tus favoritos...</p>
  </div>

  <!-- Lista de favoritos -->
  <div *ngIf="!isLoading">
    <div class="row" *ngIf="favoritos.length > 0">
      <div class="col-md-6 col-lg-4 mb-4" *ngFor="let favorito of favoritos">
        <div class="card h-100 favorito-card">
          <div class="position-relative">
            <img 
              [src]="getImageUrl(favorito)" 
              class="card-img-top" 
              [alt]="favorito.producto?.nombre"
              loading="lazy"
              style="height: 250px; object-fit: cover; cursor: pointer;"
              [routerLink]="['/productos', favorito.productoId]">
            
            <!-- Botón de quitar favorito -->
            <button 
              class="btn btn-danger btn-sm position-absolute top-0 end-0 m-2"
              (click)="quitarDeFavoritos(favorito)"
              title="Quitar de favoritos">
              <i class="bi bi-heart-fill"></i>
            </button>
          </div>

          <div class="card-body d-flex flex-column" *ngIf="favorito.producto">
            <h5 class="card-title" [routerLink]="['/productos', favorito.productoId]" style="cursor: pointer;">
              {{ favorito.producto.nombre }}
            </h5>
            
            <p class="text-muted small mb-2">
              <i class="bi bi-tag"></i> {{ favorito.producto.categoriaNombre }}
            </p>
            
            <p class="card-text text-truncate-3 flex-grow-1">
              {{ favorito.producto.descripcion }}
            </p>
            
            <div class="mt-auto">
              <!-- Precio -->
              <h4 class="text-primary mb-3">S/ {{ favorito.producto.precio }}</h4>

              <!-- Estado -->
              <div class="mb-3">
                <span class="badge" 
                      [class.bg-success]="favorito.producto.estado === 'nuevo'"
                      [class.bg-warning]="favorito.producto.estado === 'usado'">
                  {{ favorito.producto.estado === 'nuevo' ? 'Nuevo' : 'Usado' }}
                </span>
                <span class="badge bg-secondary ms-2" *ngIf="favorito.producto.vendido">
                  Vendido
                </span>
              </div>
              
              <!-- Ubicación -->
              <p class="text-muted small mb-3" *ngIf="favorito.producto.direccion">
                <i class="bi bi-geo-alt"></i> {{ favorito.producto.direccion }}
              </p>
              
              <!-- Botones -->
              <div class="d-grid gap-2">
                <a [routerLink]="['/productos', favorito.productoId]" class="btn btn-outline-primary btn-sm">
                  <i class="bi bi-eye"></i> Ver Detalles
                </a>
                <button 
                  class="btn btn-success btn-sm"
                  (click)="abrirWhatsApp(favorito)"
                  *ngIf="!favorito.producto.vendido">
                  <i class="bi bi-whatsapp"></i> Contactar
                </button>
              </div>

              <small class="text-muted d-block mt-2">
                <i class="bi bi-calendar"></i> Agregado el {{ favorito.fechaAgregado | date:'dd/MM/yyyy' }}
              </small>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Sin favoritos -->
    <div *ngIf="favoritos.length === 0" class="text-center py-5">
      <i class="bi bi-heart" style="font-size: 5rem; color: #dee2e6;"></i>
      <h3 class="mt-3">No tienes favoritos</h3>
      <p class="text-muted mb-4">Explora productos y guarda tus favoritos para verlos más tarde</p>
      <a routerLink="/productos" class="btn btn-primary btn-lg">
        <i class="bi bi-search"></i> Explorar Productos
      </a>
    </div>
  </div>
</div>