<div class="container mt-4 mb-5">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2><i class="bi bi-box-seam"></i> Mis Publicaciones</h2>
    <div class="d-flex gap-2">
      <button 
        class="btn"
        [class.btn-outline-secondary]="mostrarEliminados"
        [class.btn-secondary]="!mostrarEliminados"
        (click)="toggleMostrarEliminados()"
        *ngIf="cantidadEliminados > 0">
        <i class="bi" [class.bi-eye-slash]="mostrarEliminados" [class.bi-eye]="!mostrarEliminados"></i>
        {{ mostrarEliminados ? 'Ocultar eliminados' : 'Mostrar eliminados' }}
        <span class="badge bg-danger ms-1">{{ cantidadEliminados }}</span>
      </button>
      <a routerLink="/publicar" class="btn btn-primary">
        <i class="bi bi-plus-circle"></i> Nueva Publicación
      </a>
    </div>
  </div>

  <!-- Loader -->
  <div class="text-center py-5" *ngIf="isLoading">
    <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;"></div>
    <p class="mt-3">Cargando tus publicaciones...</p>
  </div>

  <!-- Lista de productos -->
  <div *ngIf="!isLoading">
    <div class="row" *ngIf="productosVisibles.length > 0">
      <div class="col-md-6 col-lg-4 mb-4" *ngFor="let producto of productosVisibles">
        <div class="card h-100">
          <div class="position-relative">
            <img 
              [src]="getImageUrl(producto)" 
              class="card-img-top" 
              [alt]="producto.nombre"
              loading="lazy"
              style="height: 200px; object-fit: cover;">
            
            <!-- Badges de estado -->
            <div class="position-absolute top-0 end-0 m-2">
              <span class="badge bg-success me-1" *ngIf="producto.estaActivo && !producto.vendido && !producto.eliminado">Activo</span>
              <span class="badge bg-warning text-dark" *ngIf="!producto.estaActivo && !producto.vendido && !producto.eliminado">Suspendido</span>
              <span class="badge bg-secondary" *ngIf="producto.vendido">Vendido</span>
              <span class="badge bg-danger" *ngIf="producto.eliminado">Eliminado</span>
            </div>
          </div>

          <div class="card-body d-flex flex-column">
            <h5 class="card-title">{{ producto.nombre }}</h5>
            <p class="text-muted small">{{ producto.categoriaNombre }}</p>
            <p class="card-text text-truncate-2 flex-grow-1">{{ producto.descripcion }}</p>
            
            <div class="mt-auto">
              <h4 class="text-primary mb-3">S/ {{ producto.precio }}</h4>
              
              <div class="d-grid gap-2">
                <a [routerLink]="['/productos', producto.id]" 
                   class="btn btn-outline-primary btn-sm"
                   *ngIf="!producto.eliminado">
                  <i class="bi bi-eye"></i> Ver Publicación
                </a>
                
                <button 
                  class="btn btn-success btn-sm"
                  (click)="marcarComoVendido(producto)"
                  *ngIf="!producto.vendido && !producto.eliminado"
                  [disabled]="!producto.estaActivo">
                  <i class="bi bi-check-circle"></i> Marcar como Vendido
                </button>

                <a [routerLink]="['/editar', producto.id]" 
                   class="btn btn-warning btn-sm"
                   *ngIf="!producto.eliminado">
                  <i class="bi bi-pencil"></i> Editar
                </a>
                
                <button 
                  class="btn btn-danger btn-sm"
                  (click)="eliminarProducto(producto)"
                  *ngIf="!producto.eliminado">
                  <i class="bi bi-trash"></i> Eliminar
                </button>

                <!-- Mensaje para productos suspendidos (inactivos por admin) -->
                <div class="alert alert-warning mb-0" *ngIf="!producto.estaActivo && !producto.vendido && !producto.eliminado">
                  <i class="bi bi-exclamation-circle"></i> 
                  <strong>Publicación suspendida temporalmente por un administrador</strong>
                </div>

                <!-- Mensaje para productos eliminados por admin -->
                <div *ngIf="producto.eliminado">
                  <div class="alert alert-danger mb-0">
                    <i class="bi bi-exclamation-triangle"></i> 
                    <strong>Este producto fue eliminado por no cumplir con las normas del sistema o por inactividad</strong>
                  </div>
                </div>
              </div>

              <small class="text-muted d-block mt-2">
                <i class="bi bi-calendar"></i> {{ producto.fechaCreacion | date:'dd/MM/yyyy' }}
              </small>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Sin publicaciones -->
    <div *ngIf="productosVisibles.length === 0 && productos.length > 0" class="text-center py-5">
      <i class="bi bi-eye-slash" style="font-size: 5rem; color: #dee2e6;"></i>
      <h3 class="mt-3">Productos eliminados ocultos</h3>
      <p class="text-muted mb-4">Tienes {{ cantidadEliminados }} producto(s) eliminado(s)</p>
      <button class="btn btn-secondary btn-lg" (click)="toggleMostrarEliminados()">
        <i class="bi bi-eye"></i> Mostrar productos eliminados
      </button>
    </div>

    <div *ngIf="productos.length === 0" class="text-center py-5">
      <i class="bi bi-inbox" style="font-size: 5rem; color: #dee2e6;"></i>
      <h3 class="mt-3">No tienes publicaciones</h3>
      <p class="text-muted mb-4">Publica tu primer producto y empieza a vender</p>
      <a routerLink="/publicar" class="btn btn-primary btn-lg">
        <i class="bi bi-plus-circle"></i> Publicar Ahora
      </a>
    </div>
  </div>
</div>